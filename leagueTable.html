<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCE | LEAGUE TABLE</title>
    
    <style>
        /* Inter font for modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        /* --- GENERAL BODY STYLES (DARK MODE) --- */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Tailwind gray-900 */
            color: #f9fafb; /* Tailwind gray-50 */
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* --- LEAGUE TABLE SPECIFIC STYLES --- */
        h1 {
            color: #4ade80; /* Green accent color */
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.25rem;
            font-weight: 700;
        }

        #loading {
            color: #9ca3af; /* gray-400 */
            font-style: italic;
            margin-top: 20px;
        }

        table {
            width: 100%; 
            max-width: 1100px; /* Increased max width */
            border-collapse: collapse;
            margin-top: 10px;
            background-color: #1f2937;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden; 
        }

        th, td {
            border: none;
            padding: 14px 10px; 
            text-align: center;
        }
        
        .team-name-col {
            min-width: 250px; 
            text-align: left;
            padding-left: 18px; 
        }
        
        .team-name-col div {
            display: flex;
            align-items: center;
        }

        .team-logo {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            border-radius: 50%;
            object-fit: contain;
        }

        th {
            background-color: #374151;
            color: #f3f4f6;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.95em;
            letter-spacing: 0.05em;
        }

        tr {
            border-bottom: 1px solid #374151;
        }

        /* Zebra striping */
        #teamsList tr:nth-child(odd) {
            background-color: #171f2a; 
        }

        /* Row hover effect */
        #teamsList tr:hover {
            background-color: #2a3648;
            cursor: default;
            transition: background-color 0.2s ease-in-out;
        }

        /* Specific styling for the Rank column */
        #teamsList tr td:first-child {
            font-weight: 700;
            color: #4ade80; 
        }

        /* --- USER-SUPPLIED STYLES (Non-table elements) --- */
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(209, 213, 219, 0.5); border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: transparent; }
        .nav-link { transition: all 0.2s ease-in-out; color: #d1d5db; text-decoration: none; }
        .nav-link:hover { color: #4ade80; transform: translateY(-1px); }
        h2, h3 { color: #f3f4f6; margin-bottom: 0.5rem; }
        button { transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out; }
        button:hover { transform: scale(1.02); }
        .badge { background-color: #facc15; color: #1f2937; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; font-weight: 600; margin-right: 0.5rem; margin-bottom: 0.5rem; display: inline-block; }
        @media (max-width: 768px) {
            .grid-cols-2 { grid-template-columns: 1fr !important; }
            header h1 { font-size: 1.25rem; }
        }
    </style>
</head>
<body>

    <h1>PCE | LEAGUE TABLE</h1>

    <p id="loading">Loading teams data...</p>
    <table id="leagueTable">
        <thead>
            <tr>
                <th>#</th>
                <th class="team-name-col">Team</th>
                <th>P</th>
                <th>W</th>
                <th>D</th>
                <th>L</th>
                <th>GF</th>
                <th>GA</th>
                <th>GD</th>
                <th>Pts</th>
            </tr>
        </thead>
        <tbody id="teamsList">
        </tbody>
    </table>

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    
    <script>
        // === FIREBASE CONFIGURATION ===
        const firebaseConfig = {
            apiKey: "AIzaSyB0C5O-9xh9CrmLnsD2kquCyJ1zTtYkiLg",
            authDomain: "fifa-super-league.firebaseapp.com",
            databaseURL: "https://fifa-super-league-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "fifa-super-league",
            storageBucket: "fifa-super-league.firebasestorage.app", // Your bucket is used here
            messagingSenderId: "407346622789",
            appId: "1:407346622789:web:6b48448ca0410ccf588e2c",
            measurementId: "G-Y8HVMK7SZ1"
        };

        // Initialize Firebase services
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage(); // Initialize Storage service

        // Get HTML elements
        const teamsList = document.getElementById('teamsList');
        const loadingMessage = document.getElementById('loading');
        
        const DEFAULT_LOGO_URL = 'https://via.placeholder.com/20/4ade80/000000?text=L';

        // Function to fetch and display the data from Firestore
        async function fetchTeamsData() {
            try {
                const teamsCollectionRef = db.collection('TEAMS');
                const snapshot = await teamsCollectionRef.get();

                loadingMessage.style.display = 'none';

                if (snapshot.empty) {
                    teamsList.innerHTML = '<tr><td colspan="10">No teams data found in the "TEAMS" Firestore collection.</td></tr>';
                    return;
                }

                let teamsArray = [];
                let logoUrlPromises = [];

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const team = {
                        ...data,
                        goalDifference: (data.goalsFor || 0) - (data.goalsAgainst || 0)
                    };
                    teamsArray.push(team);

                    // --- Logo URL Fetch ---
                    if (data.logoFileName) {
                        // Create a reference to the file in storage
                        const logoRef = storage.ref(data.logoFileName);
                        
                        // Get the public download URL and associate it with the team data
                        const logoPromise = logoRef.getDownloadURL().then(url => {
                            team.logoURL = url;
                        }).catch(e => {
                            console.warn(`Could not fetch logo for ${team.name || doc.id}: `, e);
                            team.logoURL = DEFAULT_LOGO_URL;
                        });
                        logoUrlPromises.push(logoPromise);
                    } else {
                        team.logoURL = DEFAULT_LOGO_URL;
                    }
                });

                // Wait for all logo URLs to be fetched before sorting and rendering
                await Promise.all(logoUrlPromises);


                // --- PROFESSIONAL SORTING LOGIC (Pts > GD > GF) ---
                teamsArray.sort((a, b) => {
                    if (b.points !== a.points) { return b.points - a.points; }
                    if (b.goalDifference !== a.goalDifference) { return b.goalDifference - a.goalDifference; }
                    return b.goalsFor - a.goalsFor;
                });

                // --- RENDER TABLE ROWS ---
                teamsArray.forEach((team, index) => {
                    const row = teamsList.insertRow();
                    
                    // # (Rank)
                    row.insertCell().textContent = index + 1; 
                    
                    // Team Name with Logo
                    const nameCell = row.insertCell();
                    nameCell.classList.add('team-name-col');

                    const logoSrc = team.logoURL || DEFAULT_LOGO_URL;
                    
                    // Create the inner structure: <div><img /> Team Name</div>
                    nameCell.innerHTML = `
                        <div>
                            <img src="${logoSrc}" alt="${team.name} logo" class="team-logo" loading="lazy">
                            ${team.name || 'N/A'}
                        </div>
                    `;
                    
                    // Remaining columns (P, W, D, L, GF, GA, GD, Pts)
                    row.insertCell().textContent = team.gamesPlayed || 0;
                    row.insertCell().textContent = team.wins || 0;
                    row.insertCell().textContent = team.draws || 0;
                    row.insertCell().textContent = team.losses || 0;
                    row.insertCell().textContent = team.goalsFor || 0;
                    row.insertCell().textContent = team.goalsAgainst || 0;
                    row.insertCell().textContent = team.goalDifference;
                    row.insertCell().textContent = team.points || 0;
                });

            } catch (error) {
                console.error("Firestore fetch failed: ", error);
                loadingMessage.textContent = 'Error loading data. Check your Firestore Security Rules!';
            }
        }

        // Call the function to start the process
        fetchTeamsData();
    </script>
</body>
</html>